const { EventEmitter } = require("node:events");
const express = require("express");
const app = express()

class WebPanel extends EventEmitter {
    constructor(port, db) {
        super(port, db)
        this.port = port;
        this.db = db;
        
        app.get('/', async(req, res) => {
            res.send(200)
        })

        app.get('/all', async(req, res) => {
            let obj = await db.all();

            let result = '<table>';
            for (let el in obj) {
                if(obj[el]._id !== undefined) {
                    result += "<tr><td>" + obj[el].key + "</td><td>" + JSON.stringify(obj[el].value) + "</td></tr>";
                } else {
                    result += "<tr><td>" + el + "</td><td>" + JSON.stringify(obj[el]) + "</td></tr>";
                }
            }
            result += '</table>';

            res.send(result);
        })

        app.listen(port, () => {
            this.emit("ready")
        })
    }
    
}

module.exports = WebPanel;